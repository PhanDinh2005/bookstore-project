<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÄÄƒng KÃ½ - BookStore</title>
    <link rel="stylesheet" href="../styles/main.css" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="auth-body">
    <div class="auth-container">
      <a href="../index.html" class="auth-logo">
        <i class="fas fa-book-open"></i> BOOKSTORE
      </a>
      <div class="auth-title">Táº¡o tÃ i khoáº£n má»›i</div>

      <div
        id="error-message"
        style="
          background: #ffe6e6;
          color: #d63031;
          padding: 10px;
          border-radius: 4px;
          font-size: 13px;
          display: none;
          margin-bottom: 15px;
          border: 1px solid red;
        "
      ></div>

      <form id="register-form" onsubmit="handleRegister(event)">
        <div class="form-group">
          <label>Há» vÃ  tÃªn</label>
          <input
            type="text"
            id="username"
            class="form-control"
            placeholder="VÃ­ dá»¥: Nguyá»…n VÄƒn A"
            required
          />
        </div>

        <div class="form-group">
          <label>Email</label>
          <input
            type="email"
            id="email"
            class="form-control"
            placeholder="email@example.com"
            required
          />
        </div>

        <div class="form-group">
          <label>Máº­t kháº©u</label>
          <input
            type="password"
            id="password"
            class="form-control"
            placeholder="Tá»± Ä‘áº·t máº­t kháº©u"
            required
          />
        </div>

        <div class="form-group">
          <label>Nháº­p láº¡i máº­t kháº©u</label>
          <input
            type="password"
            id="confirm-password"
            class="form-control"
            placeholder="XÃ¡c nháº­n máº­t kháº©u"
            required
          />
        </div>

        <button type="submit" class="btn-auth btn-submit">ÄÄ‚NG KÃ</button>
      </form>

      <div class="auth-footer">
        Báº¡n Ä‘Ã£ cÃ³ tÃ i khoáº£n? <a href="login.html">ÄÄƒng nháº­p</a>
      </div>
    </div>

    <script>
      // Cáº¥u hÃ¬nh Ä‘Æ°á»ng dáº«n Server (Äáº£m báº£o Ä‘Ãºng cá»•ng 5000)
      const API_BASE = "http://localhost:5000/api";

      async function handleRegister(event) {
        console.log("ğŸ–±ï¸ ÄÃ£ báº¥m nÃºt ÄÄƒng kÃ½!"); // Kiá»ƒm tra xem nÃºt cÃ³ Äƒn khÃ´ng
        event.preventDefault(); // Cháº·n load láº¡i trang

        // 1. Láº¥y dá»¯ liá»‡u
        const username = document.getElementById("username").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const confirmPassword =
          document.getElementById("confirm-password").value;

        const errorMsg = document.getElementById("error-message");
        const btnSubmit = document.querySelector(".btn-submit");

        // Reset lá»—i
        errorMsg.style.display = "none";
        errorMsg.innerText = "";

        // 2. Validate máº­t kháº©u
        if (password !== confirmPassword) {
          errorMsg.innerText = "âŒ Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p!";
          errorMsg.style.display = "block";
          return;
        }

        // KhÃ³a nÃºt
        btnSubmit.innerText = "Äang xá»­ lÃ½...";
        btnSubmit.disabled = true;

        try {
          console.log("ğŸš€ Äang gá»i API:", `${API_BASE}/auth/register`);

          // 3. Gá»­i lÃªn Server
          const res = await fetch(`${API_BASE}/auth/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            // LÆ°u Ã½: Backend báº¡n cáº§n 'name', 'email', 'password'
            body: JSON.stringify({ name: username, email, password }),
          });

          const data = await res.json();
          console.log("ğŸ“¦ Káº¿t quáº£:", data);

          if (res.ok || data.success) {
            alert("ğŸ‰ ÄÄƒng kÃ½ thÃ nh cÃ´ng! HÃ£y Ä‘Äƒng nháº­p ngay.");
            window.location.href = "login.html";
          } else {
            throw new Error(data.message || "ÄÄƒng kÃ½ tháº¥t báº¡i");
          }
        } catch (err) {
          console.error("Lá»—i:", err);
          errorMsg.innerText = "âš ï¸ " + (err.message || "Lá»—i káº¿t ná»‘i Server");
          errorMsg.style.display = "block";
        } finally {
          // Má»Ÿ láº¡i nÃºt dÃ¹ thÃ nh cÃ´ng hay tháº¥t báº¡i
          btnSubmit.innerText = "ÄÄ‚NG KÃ";
          btnSubmit.disabled = false;
        }
      }
    </script>
  </body>
</html>
